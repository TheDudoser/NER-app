{% extends "base.html.jinja" %}

{% block head %}
    {{ super() }}
    <link href="/public/css/search.css" rel="stylesheet">
    <style>
        .connection-type {
            font-weight: bold;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .connection-list {
            margin-left: 20px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card search-card">
                    <div class="card-body">
                        <div>
                            <h4 class="card-title mb-3"
                                style="display: flex; align-items: center;"
                            >
                                üîç –ü–æ–∏—Å–∫ –≤ —Å–ª–æ–≤–∞—Ä—è—Ö
                                <a class="btn text-decoration-none" data-bs-toggle="collapse"
                                   data-bs-target="#collapseExample" aria-expanded="false"
                                   aria-controls="collapseExample">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-info-circle" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
                                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
                                    </svg>
                                </a>
                            </h4>
                            <div class="collapse" id="collapseExample">
                                <div class="alert alert-info mb-3 d-flex align-items-center">
                                    –ü–æ–∏—Å–∫ –∏—â–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ 3—Ö –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π –∏ –Ω–∞—Ö–æ–¥–∏—Ç
                                    3 —Å–∞–º—ã—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
                                </div>
                            </div>
                        </div>

                        <form action="/search" method="get">
                            <div class="mb-3">
                                <label for="searchQuery">–û—Å–Ω–æ–≤–Ω–æ–µ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–µ*</label>
                                <input type="text" id="searchQuery" name="query" class="form-control"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É –¥–ª—è –ø–æ–∏—Å–∫–∞"
                                       value="{{ request.query_params.get('query', '') }}"
                                >
                            </div>
                            <div class="mb-3">
                                <label for="searchQuery">–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–µ</label>
                                <input type="text" id="searchQuery" class="form-control"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É –¥–ª—è –ø–æ–∏—Å–∫–∞"
                                        {#                                       value="{{ request.query_params.get('query', '') }}"#}
                                >
                                <div id="emailHelp" class="form-text">–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –Ω–∞–π—Ç–∏ –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å—Ä–∞–∑—É 2
                                    —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è –∏ –∏—Ö –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary search-btn w-100">
                                –ù–∞–π—Ç–∏
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    {% if search_results %}
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h4 class="mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h4>

                {% for dict_entry in search_results %}
                    <div class="card result-card mb-4">
                        <div class="card-body">
                            <h4 class="text-primary mb-3">
                                –°–ª–æ–≤–∞—Ä—å "{{ dict_entry.dictionary.name }}"
                            </h4>

                            {% if dict_entry.terms %}
                                {% for term_entry in dict_entry.terms %}
                                    {% if term_entry.term.phrase_type.value == PhraseType["term"].value %}
                                        {% set term_phrase_type = PhraseType["synonym"].get_desc() %}
                                    {% else %}
                                        {% set term_phrase_type = term_entry.term.phrase_type.get_desc() %}
                                    {% endif %}
                                    <div class="mb-4">
                                        <p class="mb-0">
                                            <strong style="color: {{ TYPE_COLOR[term_entry.term.phrase_type] }}">
                                                {{ term_entry.term.text }}
                                            </strong>
                                            <small class="text-muted">(–°—Ö–æ–∂–µ—Å—Ç—å: {{ term_entry.similarity|round(2) }})</small>
                                        </p>

                                        {% set connections = term_entry.connections %}
                                        <div class="mb-2">
                                            <small>
                                                {% if connections %}
                                                    {% for conn in connections %}
                                                        <strong style="color: {{ TYPE_COLOR[conn.phrase_type] }}">
                                                            {{ conn.text }}
                                                        </strong>
                                                        <span class="badge bg-info">{{ conn.phrase_type.get_desc() }}</span>
                                                    {% endfor %}
                                                {% endif %}
                                            </small>
                                        </div>

                                        {% if term_entry.sentences %}
                                            <div class="mb-3">
                                                <h6>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</h6>
                                                {% for sentence in term_entry.sentences %}
                                                    <div class="match-item d-flex justify-content-between mb-2">
                                                        <div>{{ sentence|safe }}</div>
                                                    </div>
                                                {% endfor %}
                                            </div>

                                            <hr>
                                        {% else %}
                                            <div class="alert alert-info">–ù–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è —ç—Ç–æ–≥–æ
                                                —Ç–µ—Ä–º–∏–Ω–∞
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="alert alert-info">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="alert alert-info">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
    {% endif %}
    </div>
{% endblock %}

{% block javascript %}
    {{ super() }}
{% endblock %}